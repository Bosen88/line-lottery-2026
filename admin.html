<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½çæ´»å‹•å¾Œå° (åº«å­˜ç‰ˆ)</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; padding: 20px; background: #f0f2f5; max-width: 800px; margin: 0 auto; }
        h1 { color: #333; border-bottom: 2px solid #d93025; padding-bottom: 10px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
        input[type="text"] { flex: 2; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        input[type="number"] { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #00C851; color: white; }
        .btn-save { background: #4285F4; color: white; width: 100%; font-size: 1.2rem; margin-top: 10px; }
        .btn-delete { background: #ff4444; color: white; padding: 5px 10px; font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        .preview-img { height: 40px; width: 40px; object-fit: cover; border-radius: 4px; background: #eee; }
        .count-badge { background: #e0e0e0; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>
    <h1>âš™ï¸ æŠ½çæ´»å‹•å¾Œå° (å«åº«å­˜è¨­å®š)</h1>
    <div class="card">
        <h3>æ–°å¢çé …</h3>
        <div class="input-group">
            <input type="text" id="newPrizeName" placeholder="çé …åç¨± (ä¾‹å¦‚: é™é‡å¸ƒå¶)">
            <input type="number" id="newPrizeCount" placeholder="æ•¸é‡" value="1" min="1">
            <input type="text" id="newPrizeImg" placeholder="åœ–ç‰‡é€£çµ URL (é¸å¡«)">
            <button class="btn-add" onclick="addPrize()">ï¼‹ æ–°å¢</button>
        </div>
        <small style="color: #666;">ğŸ’¡ æ•¸é‡è¨­ç‚º 0 ä»£è¡¨è©²çé …å·²è¢«æŠ½å…‰ã€‚</small>
    </div>
    <div class="card">
        <h3>ç›®å‰çš„çé …æ± </h3>
        <table>
            <thead><tr><th>åœ–ç‰‡</th><th>åç¨±</th><th>å‰©é¤˜æ•¸é‡</th><th>æ“ä½œ</th></tr></thead>
            <tbody id="prizeTableBody"></tbody>
        </table>
        <button class="btn-save" onclick="saveToFirebase()">ğŸ’¾ å„²å­˜è¨­å®šåˆ°é›²ç«¯</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ğŸ”´ğŸ”´ è«‹åœ¨ä¸‹é¢è²¼ä¸Šæ‚¨çš„ Firebase Config ğŸ”´ğŸ”´
        const firebaseConfig = {
            apiKey: "AIzaSyD_VwNV9-pcv91aFfcWQWCJ0NJtSIKi42o",
            authDomain: "lottery-2026.firebaseapp.com",
            projectId: "lottery-2026",
            storageBucket: "lottery-2026.firebasestorage.app",
            messagingSenderId: "451105292594",
            appId: "1:451105292594:web:ca1e74f3e88daae298972b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // å¾Œå°å¯†ç¢¼è¨­å®š (é è¨­ 8888)
        const password = prompt("è«‹è¼¸å…¥å¾Œå°å¯†ç¢¼", "");
        if (password !== "8888") {
            alert("å¯†ç¢¼éŒ¯èª¤");
            document.body.innerHTML = "ç„¡æ¬Šé™è¨ªå•";
            throw new Error("Access Denied");
        }

        let prizeList = [];

        window.loadConfig = async function() {
            const docRef = doc(db, "settings", "game_config");
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                prizeList = docSnap.data().prizes || [];
            } else {
                prizeList = []; // é è¨­ç‚ºç©º
            }
            renderTable();
        }

        window.renderTable = function() {
            const tbody = document.getElementById('prizeTableBody');
            tbody.innerHTML = '';
            prizeList.forEach((item, index) => {
                const imgDisplay = item.img ? `<img src="${item.img}" class="preview-img">` : 'ç„¡';
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${imgDisplay}</td><td>${item.name}</td><td><span class="count-badge">${item.count}</span></td><td><button class="btn-delete" onclick="removePrize(${index})">åˆªé™¤</button></td>`;
                tbody.appendChild(tr);
            });
        }

        window.addPrize = function() {
            const name = document.getElementById('newPrizeName').value.trim();
            const count = parseInt(document.getElementById('newPrizeCount').value) || 1;
            const img = document.getElementById('newPrizeImg').value.trim();
            if(!name) return alert("è«‹è¼¸å…¥çé …åç¨±");
            prizeList.push({ name, count, img });
            renderTable();
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('newPrizeName').value = '';
            document.getElementById('newPrizeCount').value = '1';
            document.getElementById('newPrizeImg').value = '';
        }

        window.removePrize = function(index) {
            prizeList.splice(index, 1);
            renderTable();
        }

        window.saveToFirebase = async function() {
            if(prizeList.length < 1) return alert("è‡³å°‘è¦æœ‰ä¸€å€‹çé …ï¼");
            if(!confirm("ç¢ºå®šè¦å„²å­˜å—ï¼Ÿé€™æœƒæ›´æ–°å‰å°çš„çé …åº«å­˜ã€‚")) return;
            try {
                await setDoc(doc(db, "settings", "game_config"), { prizes: prizeList });
                alert("âœ… è¨­å®šå·²æ›´æ–°æˆåŠŸï¼");
            } catch (e) {
                console.error(e);
                alert("å„²å­˜å¤±æ•—");
            }
        }
        loadConfig();
    </script>
</body>
</html>